<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>俄罗斯方块</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #222;
            color: white;
        }

        canvas {
            border: 1px solid #fff;
        }
    </style>
</head>
<body>
    <canvas id="tetris" width="300" height="600"></canvas>
    <script>
        const canvas = document.getElementById('tetris');
        const context = canvas.getContext('2d');
        const grid = 30;  // 方格大小
        const tetrominoes = [
            [[1, 1, 1], [0, 1, 0]], // T形
            [[1, 1], [1, 1]],       // 方块
            [[1, 1, 0], [0, 1, 1]], // Z形
            [[0, 1, 1], [1, 1, 0]], // S形
            [[1, 1, 1, 1]],         // 直线
            [[1, 1, 1], [1, 0, 0]], // L形
            [[1, 1, 1], [0, 0, 1]]  // J形
        ];
        let board = Array.from({ length: 20 }, () => Array(10).fill(0)); // 游戏区域
        let currentPiece, currentPosition;

        function drawBoard() {
            context.fillStyle = '#222';
            context.fillRect(0, 0, canvas.width, canvas.height);
            for (let row = 0; row < 20; row++) {
                for (let col = 0; col < 10; col++) {
                    if (board[row][col]) {
                        context.fillStyle = 'green';
                        context.fillRect(col * grid, row * grid, grid, grid);
                    }
                }
            }
        }

        function drawPiece(piece, position) {
            piece.forEach((row, r) => {
                row.forEach((cell, c) => {
                    if (cell) {
                        context.fillStyle = 'red';
                        context.fillRect((position.x + c) * grid, (position.y + r) * grid, grid, grid);
                    }
                });
            });
        }

        function collide() {
            return currentPiece.some((row, r) => {
                return row.some((cell, c) => {
                    if (cell && board[currentPosition.y + r] && board[currentPosition.y + r][currentPosition.x + c]) {
                        return true;
                    }
                    return false;
                });
            });
        }

        function placePiece() {
            currentPiece.forEach((row, r) => {
                row.forEach((cell, c) => {
                    if (cell) {
                        board[currentPosition.y + r][currentPosition.x + c] = 1;
                    }
                });
            });
        }

        function clearLines() {
            for (let row = 19; row >= 0; row--) {
                if (board[row].every(cell => cell === 1)) {
                    board.splice(row, 1);
                    board.unshift(Array(10).fill(0));
                }
            }
        }

        function rotatePiece() {
            const newPiece = currentPiece[0].map((_, i) => currentPiece.map(row => row[i])).reverse();
            if (!collide(newPiece)) {
                currentPiece = newPiece;
            }
        }

        function movePiece(dx, dy) {
            currentPosition.x += dx;
            currentPosition.y += dy;
            if (collide()) {
                currentPosition.x -= dx;
                currentPosition.y -= dy;
                if (dy === 1) {
                    placePiece();
                    clearLines();
                    newPiece();
                }
            }
        }

        function newPiece() {
            const randomIndex = Math.floor(Math.random() * tetrominoes.length);
            currentPiece = tetrominoes[randomIndex];
            currentPosition = { x: 3, y: 0 };
            if (collide()) {
                alert('游戏结束!');
                board = Array.from({ length: 20 }, () => Array(10).fill(0));
            }
        }

        function update() {
            drawBoard();
            drawPiece(currentPiece, currentPosition);
        }

        function gameLoop() {
            movePiece(0, 1);
            update();
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') movePiece(-1, 0);
            if (e.key === 'ArrowRight') movePiece(1, 0);
            if (e.key === 'ArrowDown') movePiece(0, 1);
            if (e.key === 'ArrowUp') rotatePiece();
        });

        newPiece();
        setInterval(gameLoop, 1000 / 2); // 控制游戏速度
    </script>
</body>
</html>
